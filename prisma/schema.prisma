// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}



model Passenger {
  id                 String      @id @default(cuid())
  name               String
  phone              String
  email              String   @unique
  disabilityType     DisabilityType
  accessibilityNeeds String?
  createdAt          DateTime @default(now())

  rides              Ride[]
  password           Password? 
}

model Password{
  id               String       @id @default(cuid())
  hashedPassword   String
  passengerId      String       @unique

  passenger        Passenger @relation(fields: [passengerId], references:[id], onDelete: Cascade)
}

model Driver {
  id            String   @id @default(cuid())
  name          String
  phone         String   @unique
  email         String   @unique
  licenseNumber String
  status        DriverStatus @default(Unavailable)  
  createdAt     DateTime @default(now())
  licenseExpiry DateTime

  vehicles      Vehicle[]
  rides         Ride[]
}



model Vehicle {
  id                   String      @id @default(cuid())
  driverEmail          String      @unique
  plateNumber          String
  type                 VehicleType    
  capacity             Int
  status               VehicleStatus   @default(Inactive)
  createdAt            DateTime @default(now())
  vehicleMake          String
  vehicleModel         String
  VehicleYear          DateTime
  accessibilityFeature AccessibilityFeatures[]
  images               String[]

  driver   Driver @relation(fields: [driverEmail], references: [email])
  rides    Ride[]
}



model Ride {
  id              String      @id @default(cuid())
  passengerId     String
  driverId        String
  vehicleId       String
  pickupLocation  String
  dropoffLocation String
  type            RideType   
  status          RideStatus   
  requestedAt     DateTime @default(now())
  completedAt     DateTime?
  accessNeeds     String?
  
  passenger Passenger @relation(fields: [passengerId], references: [id])
  driver    Driver    @relation(fields: [driverId], references: [id])
  vehicle   Vehicle   @relation(fields: [vehicleId], references: [id])
  payment   Payment?
}



model Payment {
  id        String      @id @default(cuid())
  rideId    String      @unique
  donorId   String?
  amount    Decimal  @db.Decimal(10,2)
  method    PaymentMethod   
  status    PaymentStatus   
  createdAt DateTime @default(now())

  ride  Ride   @relation(fields: [rideId], references: [id])
  donor Donor? @relation(fields: [donorId], references: [id])
}


model Donor {
  id               String      @id @default(cuid())
  name             String
  type             DonorType  
  contactEmail     String?
  phone            String?
  contributionType ContributionType   
  createdAt        DateTime @default(now())

  payments Payment[]
}


model Admin {
  id        String      @id @default(cuid())
  name      String
  email     String   @unique
  role      AdminRole  
  createdAt DateTime @default(now())
  password  AdminPassword?
}

model AdminPassword{
  id               String       @id @default(cuid())
  hashedPassword   String
  adminId          String       @unique

  admin            Admin @relation(fields: [adminId], references:[id], onDelete: Cascade)
}

enum DisabilityType{
  Mobility
  Sensory
  Others
}


enum AdminRole{
  Dispatcher 
  Manager 
  Admin
}

enum DriverStatus{
  Available
  Unavailable 
  Suspended
}

enum VehicleType{
  Car
  Van
  Bus
}

enum VehicleStatus{
  Active
  Inactive
}

enum RideType{
  Healthcare
  Personal
  Work
}

enum RideStatus{
  Requested
  Assigned
  In_progress
  Completed
  Cancelled
}

enum PaymentMethod{
  Cash
  Subsidy
  Donation
  Card
}

enum PaymentStatus{
  Pending
  Completed
  Failed
}

enum DonorType{
  NGO
  Government
  Corporate_CSR
  Individual
}

enum ContributionType{
  One_Time_Grant
  Per_Ride_Subsidy
  Vehicle_Donation
}

enum AccessibilityFeatures{
  Ramps_and_lifts
  Wide_door_openings
  Lowered_floors
  Swivel_seats
  Wheelchair_restraints
  Spacious_interior
  Customizable_seating
  Others
}